# corne键盘的折腾记录
从闲鱼上一个大佬那收到了两套corne的板子，一共4张，其实板子都是长一个样，因为有正反面，从一无所有到最后组成两个可用的键盘中间经历了各种折腾，现在记录如下：
两个方案：
一个是wireless的方案，用的nano nice2做控制器，在睫毛那买的板子，带了电池和排针，建议可以在睫毛那都买了。但是排针要注意，配的是方形的排针，如果用圆孔母座，会对不上，母座和排针要配对，后续会给出排针和母座的搭配方案和链接；
第二个是有线方案，其实第一个方案也可以有线连接，区别只是两个板之间需不需要trrs线连接。用的promicro rp2040的方案，优点是比较便宜，而且实际使用也不见得比无线方案差，只是想用在手机平板上就麻烦多了，需要另外配转接线。
刚开始我还以为有线方案要比无线方案难，毕竟网上有很多关于有线方案qmk的教程，结果没想到rp2040的方案是那么的坑。

## 无线Corne
- 先说无线的nano nice2方案，硬件用的foostan的classic v2的板子[foostan](https://github.com/foostan/crkbd)（硬件的其他细节也请参考foostan，classic的内容，建议详细反复观摩），二极管是其他料板拆机的二极管，控制器用的睫毛的52840nano，固件用的zmk方案，用的t18n的方案改的，用这个方案主要是要用oled方案，这个无线方案最折腾的地方就是这个oled，我oled买的是ssd1306，4pin 0.91的尺寸，在淘宝上oled 1306应该就能出来很多。我选的是这家的淘宝搜：Zave天猫旗舰店。
- 硬件部分建议新手不要焊灯，一是正负极焊反了会烧主控不说，还很不好焊，而且无线方案本来对虚焊要求就高，不建议用灯，而且灯和oled好像还会有冲突，这个我没有具体验证过所以没法下结论，反正我是没用灯的，包括底灯。但是led灯确实很酷炫，可以按照其他大佬的教程，注意正负极慢慢摸索就是了。暂时我是不会弄了。
- 简单说一下焊接硬件的注意事项，因为这个板是双面板所以两个面都可以用，二极管焊在哪一面都可以，但是建议是焊在背面，不会阻碍定位板，当然实际上如果你用扁的贴片二极管，也不是太影响，但是用插针的或者是圆柱形的贴片影响就会比较大了，所以建议是焊在背面。
- 控制器是正面朝上还是背面朝上都可以，但是要注意对应焊在哪个位置和自己板子上对应针脚的位置，这个一定要头脑清楚的时候弄，这种排针如果焊好了，想要脱焊可就费劲了，建议是加上母座，这样后续弄天线更换控制器什么的都会比较方便。
而且加了母座之后留出的空间可以把电池塞进去，当然，电池的大小要合适才可以，我在睫毛买的随带的电池可以很好的满足条件，如果单配的需要自己量好尺寸。
- 如果可以建议买带陶瓷天线的，或者另外买短的那种内置天线，不然信号太差，稍微离个距离就没法用，使用感受很差。要注意天线的接口，睫毛那的是ipex4接口。30mm的线就足够了，然后可以买最小尺寸的，记得选适配蓝牙wifi的，我是在这家店买的：创捷电子通讯。
- 我折腾了半天oled，最后找到一个办法，需要把vcc连接部分的跳线给断开，其他的三个跳线连接，然后把vcc的引脚连到板子的raw引脚，可以对照着板子和开发板引脚来飞线，然后就可以用了，至少我的是可以用了。
- 固件部分可以参考我GitHub的源码（也是别的大佬的）[zmk](https://github.com/lincoo2436/zmk-config-t18n)，fork到自己的github中，然后参考这篇keyboard-editor [keymap_editor](https://github.com/nickcoutsos/keymap-editor) 的方式修改keymap，然后在action中找到编译好的firmware下载，具体怎么弄可以在网上多搜搜，有很多的教程，这里就不啰唆了。或者你直接用我的firmware，然后keymap如下边的多图。
- 最后加一个外壳，基本上不出意外的话应该就能用了，如果出意外，那只能靠自己了。因为不同的硬件适配的情况都会有差别，大多数时候对着引脚原理应该都能解决，但是也不一定，比如像我这种小白，就不知道怎么解决，只能各种尝试然后撞大运。比如用不同人的固件方案，网上搜索解决等等，但是有一个问题，得能上外网，不然国内讨论的内容很少，怎么上外网那就是另一个话题了。
- 外壳的方案可以在闲鱼上找corne外壳，有好些卖家卖，或者有能力自己打印的，上princable上去找打印文件，自己打印一个也可以。
- 轴体，五脚轴可以不用定位板，其他的需要定位板，效果都差不多。可以不用外壳，直接用一个纸版或者泡沫垫垫着，用热熔胶粘上或者双面胶粘上就可以用，只是有点粗糙，而且不知道胶对电路板的危害，最好用那种专用在电路板上的硅胶水。这个垫的用途主要是防止轴脚对其他物品的刮伤以及防止短路。

## rp2040有线方案
- 硬件部分和无线方案的差不多，只是控制器用的rp2040的promicro开发板，在：都会明武电子 和 创客风暴两家都可以，其他的promicro的板子应该也行，而且有可能还比我买的板子更合适，我这个板子不知道为什么不能使用qmk，一刷就重新进入dfu模式，根本刷不进去固件，即使找到了能刷进去的固件，也是很多列引脚同时触发，没法用。因此最后选择了kmk的方案，一开始，kmk的方案也很折腾，有一个很奇怪的现象，就是我单纯的按照网上的典型方式定义了引脚不好使，而且即使好使了，也会出现一个按键连续触发两个不同键值的情况，很是崩溃，这里折腾了很久，一开始还以为是二极管坏了，结果硬件部分都没问题，最后定位在firmware上，在查看了kmk的说明后，发现kmk针对不同的状态有很多种引脚的扫描方式[register_of_kmk](https://kmkfw.io/scanners/)，其中一个涉及digitalIO的方式，虽然我不知道具体的含义，但是我隐约觉得这个可以有，然后就用这种扫描方式重新写了code.py文件，没想到问题解决了，触发都可以很正常的使用了。建议是用mu编辑器同步进行串口的调用和调试，这样能更快的排查问题。
- 另外，硬件部分两个板子之间的连接需要用trrs线，也就是4端子的双公头耳机线，一定要是4端子的，类似这个线，和普通的耳机线有区别。3个的没法用。然后用trrs的母座连接起来。同时两个板子都需要一个操作，就是飞线，把trrs母座尾端的一脚和开发板gpio0的引脚相连。这样才能实现rx和tx的uart通信，原先只有gpio1能实现其中一个通信通道，因此没法用，当然如果从软件层面上实现单向通信且可以进行操作应该也可以，但是那个实在超出我的能力范围了，只能等大佬了，一根飞线是我能力范围之内的事情。 
- 中间出了个意（yu）外（chun），自己把led灯的正负极弄反了，然后主控烧了，一律轻烟飘出。所以我分别在两个店里都买过主控。事实证明两家的方案一样，然后4m的也足够用了。
- oled还是和无线方案一样的oled，我买了两个，设置到了每套键盘的左手位置，反正主要是用来看当前层，我对酷炫没有什么感觉，无线显示的信息要更有用些。和无线的方案不同的是，不需要飞线，只需要按照官网的方式把所有的跳线都连接好就可以，4陀锡搞定。 
- 固件先刷入circuitpython的helixos的固件，然后把我kmk-corne下的文件都拷入加载出来的u盘根目录下[kmk](https://github.com/lincoo2436/kmk-rp2040-corne)。
- 改keymap什么的看看官网吧，我现在的keymap基本够用了。  
- 右手需要把code.py替换成code-right.py。
- 放两张图
  [keyboard](./keyboard.jpg)
  [keyboard](./pcb.jpg)

## 使用Corne的方式
- 要想用好corne那是真的难，原来的常规方式，因为按键在直列一排，很容易误触，实在是太难适应了，后来查了资料，在一个大佬那得到灵感，可以让z一行错位来更好适应，真的是好用了很多。虽然还是很容易误触，但是相比较之前，已经好很多了。基本可以达到之前同样的打字速度。但是实际使用下来，如果要用来做文字工作，还是不推荐，因为要使用的其他比如数字键什么的需要太多额外的操作，这种情况下需要比较长的时间进行训练才好适应，尤其是拼音打字的时候，才发现原来少了一排是那么的麻烦。但是如果仅仅只是日常使用，因为手指移动的距离变短，实际打字体验还是很好的。
- 如果用xda这种平胸键帽，可以考虑把键盘靠内侧的位置垫高，形成一个侧面打字的方式，也是可以挺舒服的，看外网那些大佬喜欢做chocolates（就是矮轴）的方式，其实xda应该也差不多，手感可能还要更好点。
- 还可以买两个鼠标用的手腕垫，增加舒适度。

## 无线的dongle方案
- 如果正好有一个多余的nrf52840的dongle，可以尝试利用enki42的方案来实现dongle的连接，好处是左手键盘的续航问题可以得到很好的解决，可以至少多出4，5倍的续航时间，而且连接的时候不用太考虑蓝牙连接的操作，插上就可以用，而且随时可以断开，不用担心误触发。坏处就是刷固件的时候需要刷三个硬件的固件，没有usb连接的功能，相当于一个2.4G的连接方案。具体可以参考下边的链接：[dongle](https://github.com/lincoo2436/zmk-enki42-dongle)

## 最后总结，飞线破万法，能力有限，只能用不完美的方式来解决问题，期待大佬的改善，哈哈哈。
